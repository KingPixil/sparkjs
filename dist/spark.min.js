/*
* Spark v0.1.2
* Copyright 2016-2017, Kabir Shah
* https://github.com/KingPixil//
* Free to use under the MIT license.
* https://kingpixil.github.io/license
*/
!function(t,s){"object"==typeof module&&module.exports?module.exports=s():t.Spark=s()}(this,function(){function t(t,s){s=s||{},this.data=t,this.map={},this.frequency={},this.lines=[],this.vocab=[],this.startWords=[],this.sentences=s.sentences||3,this.endWords={},this.init()}function s(t){this.opts=t||{},this.vocab={},this.totalVocab={},this.documents={},this.totalDocs=0,this.train=function(t,s){var o=t.split(" ");this.totalDocs++,this.vocab[s]||(this.vocab[s]={}),this.documents[s]?this.documents[s]++:this.documents[s]=1,this.totalVocab[s]||(this.totalVocab[s]=0);for(var i=0;i<o.length;i++){var a=o[i];this.totalVocab[s]++,void 0===this.vocab[s][a]?this.vocab[s][a]=1:this.vocab[s][a]++}},s.getPriorProb=function(t,s){return t/s},s.max=function(t){return Object.keys(t).reduce(function(s,o){return t[s]>t[o]?s:o})},s.toObj=function(t){for(var s={},o=0;o<t.length;o++)s[t[o]]?s[t[o]]++:s[t[o]]=1;return s},s.getState=function(){return{vocab:this.vocab,totalVocab:this.totalVocab,documents:this.totalDocuments,totalDocs:this.totalDocs}},s.classify=function(t){var s={},o=this.toObj(t.split(" "));for(var i in this.vocab){var a=this.getPriorProb(this.documents[i],this.totalDocs);s[i]=a;for(var n in this.vocab[i])o[n]?s[i]*=(this.vocab[i][n]+1)/(this.documents[i]+this.totalVocab[i]):s[i]*=1-(this.vocab[i][n]+1)/(this.documents[i]+this.totalVocab[i]);s[i]=s[i]/a+(1-s[i])*(1-a)}var r=this.max(s);return this.opts.verbose?{confidence:s,choice:r}:r}}var o={MarkovChain:t,NaiveBayes:s},i=function(t){return t[Math.floor(Math.random()*t.length)]};return t.prototype.init=function(){this.lines=this.data.replace(/([.?!])\s*(?=[A-Z])/g,"$1|").split("|");for(var t=0;t<this.lines.length;t++){for(var s=this.lines[t],o=s.split(" "),i=[],a=0;a<o.length;a+=2)o[a+1]?i.push(o[a]+" "+o[a+1]):i.push(o[a]);this.startWords.push(i[0]),this.endWords[i[i.length-1]]=!0;for(var a=0;a<i.length;a++)this.vocab.push(i[a]),this.map[i[a]]?this.map[i[a]].push(i[a+1]):this.map[i[a]]=[i[a+1]]}},t.prototype.generate=function(t){if(t=t||{},this.start=i(this.startWords),t.start){var s=this.startWords.filter(function(s){return t.start.test(s)});this.start=i(s)}t.end&&(this.endWords={},this.endWords[t.end]=!0);for(var o=this.start,a=0,n=[o],r=0;this.map.hasOwnProperty(o);){r++;var h=i(this.map[o]);if(n.push(h),o=h,(this.endWords.hasOwnProperty(h)||this.map[h]===[void 0]||/\\end\{.+\}/g.test(h))&&a++,a===this.sentences)break}return n.join(" ")},o});